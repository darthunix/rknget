Описание (Description)

0. Весь код написан целиком на python3.6 с использованием штатных библиотек из дистрибутивов.

1. Проект изначально предназначался для одного из московских провайдеров. При обнаружении конфиденциальной информации просьба сообщить автору.

2. Из-за кривых выгрузок РКН правила обработки могут содержать особую, уличную магию.

3. Для корректной выгрузки Вам нужно обладать подписанным request.xml на имя Вашей организации. (Логика РКН в этом плане абсолютно не понятна. Информация общедоступна, а для раздачи файла dump.xml.zip достаточно лишь содержать приличный вебсервер и хороший канал связи.)

Требования (Requirements):
    zeep
    urllib
    xml
    zipfile
    yaml
    psycopg2 
    sqlalchemy

Установка:

1. Разверните СУБД (например, postgres). 1 ГБ памяти и 5 ГБ хранилища будет достаточно.
2. Создайте БД и пользователя для неё, настройте права на подключение.
3. Запустите скрипт дампа (пока только postgres) для создания таблиц, индексов, ключей.
4. Настройте параметры блокировки для rknget в config.yml:
  a. Global - пути, в т.ч. к файлам запроса к выгрузкам и подписи.
  b. DumpLoader - параметры SOAP-клиента.
  c. DB - параметры подключения к БД.
  d. Blocking - методы блокировки. basic - как должно быть. Остальное - по ситуации.
  e. Logging - параметры логирования.
5. Настройте запуск скрипта по cron.

Проблемы:

- Я дебажил скрипт, и теперь он не запускается.
- Программа делает в таблице Log PID-подобную запись. Это сделано для избежания двойного запуска. Поставьте forcerun=True или переименуйте файл программы.

- Слишком много ложных срабатываний АС Ревизор.
- Вопрос имплементации блокировок сильно зависит от конфигурации ваших сети и сервисов.

- В базе некорректные данные.
- К сожалению, в дампе тоже много недочётов. Никто не фильтрует контент по ту сторону баррикад. Приходится изворачиваться с URL Encoding.

- В базе не хватает данных.
- Программа отбрасывает заведомо невалидные ip, ipsubnet, non-http(s) proto urls.

- В выгрузке заведомо больше подсетей и доменов.
- Методы делают склеивание подсетей и удаляют лишние домены при наличии wildcard уровнем выше.

- На этапе парсинга вылазит ошибка.
- На момент написания программа парсит всё то, что соответствует текущему формату дампа.

- У меня не работает на SomethingDB.
- Набор скриптов делался под PostgreSQL, извините.

- Скрипт поломал ServiceName, и тот не запускается.
- Дважды извините. Тыжпрограммист, сынтегрируй, побольше палок и фекалий.


Дисклеймер (Disclaimer)

0. Вы можете использовать код в своих целях "как есть", на свой страх и риск. Автор не несёт ответственности за отстреленные ноги и заявления по собственному, а также не даёт гарантии, что полученные дампы будут благополучно съедены вашими DPI, MITM, проксями, резолверами, поделками на bash/perl/php/python/etc.

Ссылки (References)

http://vigruzki.rkn.gov.ru/docs/description_for_operators_actual.pdf
